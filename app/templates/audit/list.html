{% extends "base.html" %}
{% block content %}
<div class="topbar">
  <div>
    <h1 class="h1">Audit Log</h1>
    <div class="sub">Track changes, reversals and imports.</div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form method="get" class="form" style="margin-bottom:12px;">
      <div class="grid cols-2">
        <div class="field">
          <label>Entity Type (ITEM / SALE / IMPORT_BATCH)</label>
          <input name="entity_type" value="{{ entity_type }}" placeholder="ITEM">
        </div>
        <div class="field">
          <label>Entity PK ID</label>
          <input name="entity_pk_id" value="{{ entity_pk_id }}" placeholder="Paste PK ID">
        </div>
      </div>
      <div style="display:flex; gap:10px;">
        <button class="btn primary" type="submit">Filter</button>
        <a class="btn" href="{{ url_for('routes.audit_list') }}">Clear</a>
      </div>
    </form>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Entity</th>
            <th>Action</th>
            <th>Field</th>
            <th>Old</th>
            <th>New</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody>
          {% for a in logs %}
          <tr>
            <td>{{ a.created_at }}</td>
            <td>{{ a.entity_type }} / {{ a.entity_pk_id }}</td>
            <td>{{ a.action }}</td>
            <td>{{ a.field_name or "" }}</td>
            <td>{{ a.old_value or "" }}</td>
            <td>{{ a.new_value or "" }}</td>
            <td>{{ a.reason or "" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

